let n=null;async function s(e){(await chrome.runtime.getContexts({contextTypes:[chrome.runtime.ContextType.OFFSCREEN_DOCUMENT],documentUrls:[e]})).length>0||(n?await n:(n=chrome.offscreen.createDocument({url:e,reasons:[chrome.offscreen.Reason.AUDIO_PLAYBACK],justification:"To run WASM audio processing in the background"}),await n,n=null))}chrome.runtime.onMessage.addListener((e,o,t)=>{if(console.log("Received message:",e),e.type==="TRANSCRIBE")return(async()=>{try{await s("src/offscreen/index.html");const r=await chrome.runtime.sendMessage({...e,type:"OFFSCREEN_TRANSCRIBE"});t(r)}catch(r){console.error("Error in background handler:",r),t({error:r.message})}})(),!0});
